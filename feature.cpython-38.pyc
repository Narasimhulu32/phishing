U

    â€˜)c7?  Ã£                   @   sÅ    d dl Z d dlZd dlZd dlmZ d dlZd dlZd dlm	Z	 d dl
Z
d dlmZmZ d dl
Z
d dlmZ d dlmZ G ddâ€ dÆ’ZdS )	Ã©    N)Ãš
BeautifulSoup)Ãšsearch)ÃšdateÃšdatetime)Ãšparse)Ãšurlparsec                   @   s  e Zd Zg Zddâ€ Zddâ€ Zddâ€ Zddâ€ Zd	d
â€ Zddâ€ Z	d
dâ€ Z
ddâ€ Zddâ€ Zddâ€ Z
ddâ€ Zddâ€ Zddâ€ Zddâ€ Zddâ€ Zdd â€ Zd!d"â€ Zd#d$â€ Zd%d&â€ Zd'd(â€ Zd)d*â€ Zd+d,â€ Zd-d.â€ Zd/d0â€ Zd1d2â€ Zd3d4â€ Zd5d6â€ Zd7d8â€ Zd9d:â€ Z d;d<â€ Z!d=d>â€ Z"d?d@â€ Z#dAS )BÃšFeatureExtractionc                 C   sâ‚¬  g | _ || _d| _d| _d| _d| _d| _ztÂ |Â¡| _t	tj
dÆ’| _W n   Y nX zt|Æ’| _| jj| _W n   Y nX ztÂ | jÂ¡| _W n   Y nX | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â Â¡ Â¡ | j Â 
| Â  Â¡ Â¡ | j Â 
| Â !Â¡ Â¡ | j Â 
| Â "Â¡ Â¡ | j Â 
| Â #Â¡ Â¡ | j Â 
| Â $Â¡ Â¡ | j Â 
| Â %Â¡ Â¡ | j Â 
| Â &Â¡ Â¡ | j Â 
| Â 'Â¡ Â¡ | j Â 
| Â (Â¡ Â¡ | j Â 
| Â )Â¡ Â¡ | j Â 
| Â *Â¡ Â¡ | j Â 
| Â +Â¡ Â¡ d S )NÃš zhtml.parser),ÃšfeaturesÃšurlÃšdomainÃšwhois_responser   ÃšresponseÃšsoupÃšrequestsÃšgetr   ÃštextÃšnetlocÃšwhoisÃšappendÃšUsingIpÃšlongUrlÃšshortUrlÃšsymbolÃšredirectingÃšprefixSuffixÃš
SubDomainsÃšHpptsÃšDomainRegLenÃšFaviconÃš
NonStdPortÃšHTTPSDomainURLÃš
RequestURLÃš	AnchorURLÃšLinksInScriptTagsÃšServerFormHandlerÃš	InfoEmailÃšAbnormalURLÃšWebsiteForwardingÃš
StatusBarCustÃšDisableRightClickÃšUsingPopupWindowÃšIframeRedirectionÃšAgeofDomainÃšDNSRecordingÃšWebsiteTrafficÃšPageRankÃšGoogleIndexÃšLinksPointingToPageÃšStatsReport)Ãšselfr   Â© r5   ÃºEC:\Users\Admin\Machine Learning\PJ5 Phishing URL Detection\feature.pyÃš__init__   sf    
zFeatureExtraction.__init__c                 C   s&   zt Â | jÂ¡ W dS    Y dS X d S )NÃ©Ã¿Ã¿Ã¿Ã¿Ã©   )Ãš	ipaddressÃš
ip_addressr   Â©r4   r5   r5   r6   r   Q   s
    zFeatureExtraction.UsingIpc                 C   s6   t | jÆ’dk rdS t | jÆ’dkr2t | jÆ’dkr2dS dS )NÃ©6   r9   Ã©K   r   r8   )Ãšlenr   r<   r5   r5   r6   r   Y   s
    zFeatureExtraction.longUrlc                 C   s   t Â d| jÂ¡}|rdS dS )Na  bit\.ly|goo\.gl|shorte\.st|go2l\.ink|x\.co|ow\.ly|t\.co|tinyurl|tr\.im|is\.gd|cli\.gs|yfrog\.com|migre\.me|ff\.im|tiny\.cc|url4\.eu|twit\.ac|su\.pr|twurl\.nl|snipurl\.com|short\.to|BudURL\.com|ping\.fm|post\.ly|Just\.as|bkite\.com|snipr\.com|fic\.kr|loopt\.us|doiop\.com|short\.ie|kl\.am|wp\.me|rubyurl\.com|om\.ly|to\.ly|bit\.do|t\.co|lnkd\.in|db\.tt|qr\.ae|adf\.ly|goo\.gl|bitly\.com|cur\.lv|tinyurl\.com|ow\.ly|bit\.ly|ity\.im|q\.gs|is\.gd|po\.st|bc\.vc|twitthis\.com|u\.to|j\.mp|buzurl\.com|cutt\.us|u\.bb|yourls\.org|x\.co|prettylinkpro\.com|scrnch\.me|filoops\.info|vzturl\.com|qr\.net|1url\.com|tweez\.me|v\.gd|tr\.im|link\.zip\.netr8   r9   )Ãšrer   r   Â©r4   Ãšmatchr5   r5   r6   r   a   s    ÃºzFeatureExtraction.shortUrlc                 C   s   t Â d| jÂ¡rdS dS )NÃº@r8   r9   )r@   Ãšfindallr   r<   r5   r5   r6   r   n   s    zFeatureExtraction.symbolc                 C   s   | j Â dÂ¡dkrdS dS )Nz//Ã©   r8   r9   )r   Ãšrfindr<   r5   r5   r6   r   t   s    zFeatureExtraction.redirectingc                 C   s2   zt Â d| jÂ¡}|rW dS W dS    Y dS X d S )Nz\-r8   r9   )r@   rD   r   rA   r5   r5   r6   r   z   s    zFeatureExtraction.prefixSuffixc                 C   s.   t tÂ d| jÂ¡Æ’}|dkrdS |dkr*dS dS )NÃº\.r9   Ã©   r   r8   )r?   r@   rD   r   )r4   Ãš	dot_countr5   r5   r6   r   â€   s    zFeatureExtraction.SubDomainsc                 C   s0   z| j j}d|krW dS W dS    Y dS X d S )NÃšhttpsr9   r8   )r   Ãšscheme)r4   rJ   r5   r5   r6   r   Â   s    zFeatureExtraction.Hpptsc                 C   sËœ   zâ€| j j}| j j}zt|Æ’r$|d }W n   Y nX zt|Æ’rF|d }W n   Y nX |j|j d |j|j  }|dkrâ‚¬W dS W dS    Y dS X d S )Nr   Ã©   r9   r8   )r
   Ãšexpiration_dateÃš
creation_dater?   ÃšyearÃšmonth)r4   rM   rN   Ãšager5   r5   r6   r   â€”   s&    zFeatureExtraction.DomainRegLenc                 C   sâ€   zâ‚¬| j Â dÂ¡D ]l}| j jdddÂD ]V|_ddâ€ tÂ d|jd Â¡D Æ’}| j|jd ksnt|Æ’d	ksnt|jd kr"  W d	S q"qW d
S    Y d
S X d S )NÃšheadÃšlinkTÂ©Ãšhrefc                 S   s   g | ]}|Â  d Â¡â€˜qS Â©r   Â©ÃšstartÂ©Ãš.0Ãšxr5   r5   r6   Ãš
<listcomp>Â²   s     z-FeatureExtraction.Favicon.<locals>.<listcomp>rG   rU   r9   r8   )r   Ãšfind_allrS   r@   Ãšfinditerr   r?   r   )r4   rR   Ãšdotsr5   r5   r6   r   Â®   s    *zFeatureExtraction.Faviconc                 C   s8   z$| j Â dÂ¡}t|Æ’dkr W dS W dS    Y dS X d S )NÃº:r9   r8   )r   Ãšsplitr?   )r4   Ãšportr5   r5   r6   r    Âº   s    zFeatureExtraction.NonStdPortc                 C   s*   zd| j krW dS W dS    Y dS X d S )NrJ   r8   r9   )r   r<   r5   r5   r6   r!   Ã„   s    
z FeatureExtraction.HTTPSDomainURLc           	      C   s$  Âz| j jdddÂD ]V}ddâ€ tÂ d|d Â¡D Æ’}| j|d ksZ| j|d ksZt|Æ’dkrb|d }|d }q| j jd	ddÂD ]V}d
dâ€ tÂ d|d Â¡D Æ’}| j|d ksÃ‚| j|d ksÃ‚t|Æ’dkrÃŠ|d }|d }q|| j jdddÂD ]\}ddâ€ tÂ d|d Â¡D Æ’}| j|d kÂs0| j|d kÂs0t|Æ’dkÂr8|d }|d }qÃ¤| j jd
ddÂD ]^}ddâ€ tÂ d|d Â¡D Æ’}| j|d kÂsÅ¾| j|d kÂsÅ¾t|Æ’dkÂrÂ¦|d }|d }ÂqRzJ|t|Æ’ d }|dk ÂrÃ–W W dS |dkÂrÃ²|dk ÂrÃ²W W dS W W dS W n   Y W dS X W n   Y dS X d S )NÃšimgTÂ©Ãšsrcc                 S   s   g | ]}|Â  d Â¡â€˜qS rV   rW   rY   r5   r5   r6   r\   Ã   s     z0FeatureExtraction.RequestURL.<locals>.<listcomp>rG   re   r9   Ãšaudioc                 S   s   g | ]}|Â  d Â¡â€˜qS rV   rW   rY   r5   r5   r6   r\   Ã–   s     Ãšembedc                 S   s   g | ]}|Â  d Â¡â€˜qS rV   rW   rY   r5   r5   r6   r\   Ãœ   s     Ãšiframec                 S   s   g | ]}|Â  d Â¡â€˜qS rV   rW   rY   r5   r5   r6   r\   Ã¢   s     Ã©d   g      6@g     â‚¬N@r   r8   Â©r   r]   r@   r^   r   r   r?   Ãšfloat)	r4   rc   r_   ÃšsuccessÃširf   rg   rh   Ãš
percentager5   r5   r6   r"   Ã   s@    (
(
.
.
zFeatureExtraction.RequestURLc                 C   sÃ¢   zÃd\}}| j jdddÂD ]Z}d|d ksdd|d Â Â¡ ksdd|d Â Â¡ ksdt|d ksl| j|d ksl|d	 }|d	 }qzD|t|Æ’ d
 }|dk rËœW W d	S |dkrÂ°|dk rÂ°W W d
S W W dS W n   Y W dS X W n   Y dS X d S )NÂ©r   r   ÃšaTrT   Ãº#rU   Z
javascriptÃšmailtor9   ri   g      ?@g     Ã€P@r   r8   )r   r]   Ãšlowerr   r   rk   )r4   rm   Ãšunsaferp   rn   r5   r5   r6   r#   Ãµ   s"    F
zFeatureExtraction.AnchorURLc                 C   sN  Âz8d\}}| j jdddÂD ]V}ddâ€ tÂ d|d Â¡D Æ’}| j|d ksb| j|d ksbt|Æ’d	krj|d	 }|d	 }q| j jd
ddÂD ]V}ddâ€ tÂ d|d
 Â¡D Æ’}| j|d
 ksÃŠ| j|d
 ksÃŠt|Æ’d	krÃ’|d	 }|d	 }qâ€zJ|t|Æ’ d }|dk Âr W W d	S |dkÂr|dk ÂrW W dS W W dS W n   Y W dS X W n   Y dS X d S )Nro   rS   TrT   c                 S   s   g | ]}|Â  d Â¡â€˜qS rV   rW   rY   r5   r5   r6   r\     s     z7FeatureExtraction.LinksInScriptTags.<locals>.<listcomp>rG   rU   r9   Ãšscriptrd   c                 S   s   g | ]}|Â  d Â¡â€˜qS rV   rW   rY   r5   r5   r6   r\     s     re   ri   g      1@g     @T@r   r8   rj   )r4   rm   rl   rS   r_   ru   rn   r5   r5   r6   r$     s.    (
(

z#FeatureExtraction.LinksInScriptTagsc                 C   sËœ   zâ€t | jjdddÂÆ’dkr W dS | jjdddÂD ]P}|d dksL|d dkrT W d	S | j|d krx| j|d krx W dS  W dS q0W n   Y d	S X d S )
NÃšformT)Ãšactionr   r9   rw   r	   zabout:blankr8   )r?   r   r]   r   r   )r4   rv   r5   r5   r6   r%   *  s    z#FeatureExtraction.ServerFormHandlerc                 C   s2   zt Â d| jÂ¡rW dS W dS W n   Y dS X d S )Nz[mail\(\)|mailto:?]r8   r9   )r@   rD   Zsoapr<   r5   r5   r6   r&   :  s    
zFeatureExtraction.InfoEmailc                 C   s2   z| j j| jkrW dS W dS W n   Y dS X d S )Nr9   r8   )r   r   r
   r<   r5   r5   r6   r'   D  s    
zFeatureExtraction.AbnormalURLc                 C   sJ   z6t | jjÆ’dkrW dS t | jjÆ’dkr.W dS W dS W n   Y dS X d S )Nr9   Ã©   r   r8   )r?   r   Ãšhistoryr<   r5   r5   r6   r(   N  s    
z#FeatureExtraction.WebsiteForwardingc                 C   s4   z t Â d| jjÂ¡rW dS W dS W n   Y dS X d S )Nz <script>.+onmouseover.+</script>r9   r8   Â©r@   rD   r   r   r<   r5   r5   r6   r)   Z  s    
zFeatureExtraction.StatusBarCustc                 C   s4   z t Â d| jjÂ¡rW dS W dS W n   Y dS X d S )Nzevent.button ?== ?2r9   r8   rz   r<   r5   r5   r6   r*   d  s    
z#FeatureExtraction.DisableRightClickc                 C   s4   z t Â d| jjÂ¡rW dS W dS W n   Y dS X d S )Nzalert\(r9   r8   rz   r<   r5   r5   r6   r+   n  s    
z"FeatureExtraction.UsingPopupWindowc                 C   s4   z t Â d| jjÂ¡rW dS W dS W n   Y dS X d S )Nz[<iframe>|<frameBorder>]r9   r8   rz   r<   r5   r5   r6   r,   x  s    
z#FeatureExtraction.IframeRedirectionc                 C   sv   zb| j j}zt|Æ’r|d }W n   Y nX tÂ Â¡ }|j|j d |j|j  }|dkr^W dS W dS    Y dS X d S Â©Nr   rL   rE   r9   r8   Â©r
   rN   r?   r   ÃštodayrO   rP   Â©r4   rN   r}   rQ   r5   r5   r6   r-   â€š  s    zFeatureExtraction.AgeofDomainc                 C   sv   zb| j j}zt|Æ’r|d }W n   Y nX tÂ Â¡ }|j|j d |j|j  }|dkr^W dS W dS    Y dS X d S r{   r|   r~   r5   r5   r6   r.   â€  s    zFeatureExtraction.DNSRecordingc                 C   sP   z<t tjÂ dt Â¡Â Â¡ dÆ’Â dÂ¡d }t|Æ’dk r8W dS W dS    Y dS X d S )	Nz,http://data.alexa.com/data?cli=10&dat=s&url=ÃšxmlZREACHZRANKÃ©Â â€  r9   r   r8   )r   ÃšurllibÃšrequestÃšurlopenr   ÃšreadÃšfindÃšint)r4   Ãšrankr5   r5   r6   r/   Â¦  s    $z FeatureExtraction.WebsiteTrafficc                 C   sX   zDt Â dd| jiÂ¡}ttÂ dtjÂ¡d Æ’}|dkr@|dk r@W dS W dS    Y dS X d S )Nz'https://www.checkpagerank.net/index.phpÃšnamezGlobal Rank: ([0-9]+)r   râ‚¬   r9   r8   )r   Ãšpostr   râ€    r@   rD   Zrank_checker_responser   )r4   Zprank_checker_responseZglobal_rankr5   r5   r6   r0   Â°  s    zFeatureExtraction.PageRankc                 C   s4   z t | jdÆ’}|rW dS W dS W n   Y dS X d S )NÃ©   r9   r8   )r   r   )r4   Zsiter5   r5   r6   r1   Â½  s    
zFeatureExtraction.GoogleIndexc                 C   sN   z:t tÂ d| jjÂ¡Æ’}|dkr$W dS |dkr2W dS W dS W n   Y dS X d S )Nz<a href=r   r9   rH   r8   )r?   r@   rD   r   r   )r4   Znumber_of_linksr5   r5   r6   r2   Ãˆ  s    
z%FeatureExtraction.LinksPointingToPagec                 C   sR   z>t Â dtÂ¡}tÂ | jÂ¡}t Â d|Â¡}|r0W dS |r:W dS W dS    Y dS X d S )Nzeat\.ua|usa\.cc|baltazarpresentes\.com\.br|pe\.hu|esy\.es|hol\.es|sweddy\.com|myjino\.ru|96\.lt|ow\.lya  146\.112\.61\.108|213\.174\.157\.151|121\.50\.168\.88|192\.185\.217\.116|78\.46\.211\.158|181\.174\.165\.13|46\.242\.145\.103|121\.50\.168\.40|83\.125\.22\.219|46\.242\.145\.98|107\.151\.148\.44|107\.151\.148\.107|64\.70\.19\.203|199\.184\.144\.27|107\.151\.148\.108|107\.151\.148\.109|119\.28\.52\.61|54\.83\.43\.69|52\.69\.166\.231|216\.58\.192\.225|118\.184\.25\.86|67\.208\.74\.71|23\.253\.126\.58|104\.239\.157\.210|175\.126\.123\.219|141\.8\.224\.221|10\.10\.10\.10|43\.229\.108\.32|103\.232\.215\.140|69\.172\.201\.153|216\.218\.185\.162|54\.225\.104\.146|103\.243\.24\.98|199\.59\.243\.120|31\.170\.160\.61|213\.19\.128\.77|62\.113\.226\.131|208\.100\.26\.234|195\.16\.127\.102|195\.16\.127\.157|34\.196\.13\.28|103\.224\.212\.222|172\.217\.4\.225|54\.72\.9\.51|192\.64\.147\.141|198\.200\.56\.183|23\.253\.164\.103|52\.48\.191\.26|52\.214\.197\.72|87\.98\.255\.18|209\.99\.17\.27|216\.38\.62\.18|104\.130\.124\.96|47\.89\.58\.141|78\.46\.211\.158|54\.86\.225\.156|54\.82\.156\.19|37\.157\.192\.102|204\.11\.56\.48|110\.34\.231\.42r8   r9   )r@   r   r   ÃšsocketÃš
gethostbynamer   )r4   Z	url_matchr;   Zip_matchr5   r5   r6   r3   Ã•  s      Ã¿Ã»zFeatureExtraction.StatsReportc                 C   s   | j S )N)r
   r<   r5   r5   r6   ÃšgetFeaturesListÃ¨  s    z!FeatureExtraction.getFeaturesListN)$Ãš__name__Ãš
__module__Ãš__qualname__r
   r7   r   r   r   r   r   r   r   r   r   r   r    r!   r"   r#   r$   r%   r&   r'   r(   r)   r*   r+   r,   r-   r.   r/   r0   r1   r2   r3   rÂ   r5   r5   r5   r6   r      sB   A

	

	(








r   )r:   r@   Ãšurllib.requestrÂ   Ãšbs4r   râ€¹   r   Zgooglesearchr   r   r   r   ÃštimeÃšdateutil.parserr   Z
date_parseÃšurllib.parser   r   r5   r5   r5   r6   Ãš<module>   s   
